// ================================================================
// ğŸ• STEP 2: ì‹œê°„ ì§€ì—°ê³¼ ë¹„ë™ê¸° (4ë¬¸ì œ)
// ================================================================

// ë¬¸ì œ 2-1: 1ì´ˆ í›„ì— ì„±ê³µí•˜ëŠ” Promise
// ìš”êµ¬ì‚¬í•­:
// - setTimeoutì„ ì‚¬ìš©í•´ì„œ 1ì´ˆ í›„ì— resolve í˜¸ì¶œ
// - "1ì´ˆ ê¸°ë‹¤ë ¸ìŠµë‹ˆë‹¤!" ë©”ì‹œì§€ ì „ë‹¬

function step2_1() {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve("1ì´ˆ ê¸°ë‹¤ë ¸ìŠµë‹ˆë‹¤.");
    }, 1000);
  });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// console.log("ì‹œì‘");
// step2_1().then(message => console.log("ê²°ê³¼:", message));
// console.log("ë"); // ì´ê²Œ ë¨¼ì € ì¶œë ¥ë˜ì–´ì•¼ í•¨

// ================================================================
// ë¬¸ì œ 2-3: ì§€ì—° ì‹œê°„ì„ ë°›ëŠ” í•¨ìˆ˜ ë§Œë“¤ê¸°
// ìš”êµ¬ì‚¬í•­:
// - delay(ms) í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”
// - ì£¼ì–´ì§„ ë°€ë¦¬ì´ˆë§Œí¼ ê¸°ë‹¤ë¦° í›„ "ê¸°ë‹¤ë¦¼ ì™„ë£Œ!" ë©”ì‹œì§€ ë°˜í™˜
// - ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì€ ms ì‹œê°„ë§Œí¼ setTimeout ì‚¬ìš©

function delay(ms) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve("ê¸°ë‹¤ë¦¼ ì™„ë£Œ");
    }, ms);
  });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// delay(1500).then((message) => console.log("1.5ì´ˆ í›„:", message));

// ================================================================
// ë¬¸ì œ 2-4: ëœë¤ ì‹œê°„ ì§€ì—°
// ìš”êµ¬ì‚¬í•­:
// - randomDelay() í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”
// - 1ì´ˆ~3ì´ˆ ì‚¬ì´ì˜ ëœë¤í•œ ì‹œê°„ í›„ì— ì„±ê³µ
// - "Xì´ˆ ê¸°ë‹¤ë ¸ìŠµë‹ˆë‹¤!" ë©”ì‹œì§€ ë°˜í™˜ (XëŠ” ì‹¤ì œ ëŒ€ê¸°í•œ ì´ˆ)
// - Math.random() ì‚¬ìš©

function randomDelay() {
  let randomTime = parseInt(Math.random() * 2000 + 1000); // 1ì´ˆ ~ 3ì´ˆ
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve(`${randomTime}ì´ˆ ê¸°ë‹¤ë ¸ìŠµë‹ˆë‹¤.`);
    }, randomTime);
  });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// randomDelay().then((message) => console.log(message));

// ================================================================
// ğŸ”— STEP 3: then ì²´ì´ë‹ ê¸°ì´ˆ (4ë¬¸ì œ)
// ================================================================

// ë¬¸ì œ 3-1: ê°„ë‹¨í•œ then ì²´ì´ë‹
// ìš”êµ¬ì‚¬í•­:
// - Promise.resolve(5)ë¡œ ì‹œì‘
// - ì²« ë²ˆì§¸ thenì—ì„œ ìˆ«ìì— 2ë¥¼ ê³±í•˜ê¸°
// - ë‘ ë²ˆì§¸ thenì—ì„œ ê²°ê³¼ë¥¼ ì¶œë ¥
// - ê° thenì—ì„œ ê°’ì„ return í•´ì•¼ ë‹¤ìŒ thenìœ¼ë¡œ ì „ë‹¬ë¨

function step3_1() {
  let promise = new Promise((resolve, reject) => {
    try {
      resolve(5);
    } catch (error) {
      reject(error);
    }
  });

  promise
    .then((result) => {
      return (result *= 2);
    })
    .then((result) => console.log("ê²°ê³¼ : " + result));
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step3_1();

// ================================================================
// ë¬¸ì œ 3-2: ë¬¸ìì—´ ë³€í™˜ ì²´ì´ë‹
// ìš”êµ¬ì‚¬í•­:
// - Promise.resolve("hello")ë¡œ ì‹œì‘
// - ì²« ë²ˆì§¸ then: ëŒ€ë¬¸ìë¡œ ë³€í™˜ (toUpperCase())
// - ë‘ ë²ˆì§¸ then: ëì— "!" ì¶”ê°€
// - ì„¸ ë²ˆì§¸ then: ê²°ê³¼ ì¶œë ¥

function step3_2() {
  return new Promise((resolve, reject) => {
    try {
      resolve("hello");
    } catch (error) {
      reject("ì‹¤íŒ¨");
    }
  })
    .then((str) => {
      return (str = str.toUpperCase());
    })
    .then((str) => {
      let newArr = str.split("");
      newArr.push("!");
      return newArr.join("");
    })
    .then((str) => {
      console.log(str);
    });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step3_2(); // "HELLO!" ì¶œë ¥ë˜ì–´ì•¼ í•¨

// ================================================================
// ë¬¸ì œ 3-3: ë¹„ë™ê¸° ì²´ì´ë‹
// ìš”êµ¬ì‚¬í•­:
// - step2_3ì—ì„œ ë§Œë“  delay() í•¨ìˆ˜ ì‚¬ìš©
// - delay(1000)ìœ¼ë¡œ ì‹œì‘
// - ì²« ë²ˆì§¸ thenì—ì„œ "ì²« ë²ˆì§¸ ì™„ë£Œ" ì¶œë ¥í•˜ê³  delay(500) ë°˜í™˜
// - ë‘ ë²ˆì§¸ thenì—ì„œ "ë‘ ë²ˆì§¸ ì™„ë£Œ" ì¶œë ¥

function step3_3() {
  delay(1000)
    .then(() => {
      console.log("ì²« ë²ˆì§¸ ì™„ë£Œ");
      return delay(500);
    })
    .then(() => console.log("ë‘ ë²ˆì§¸ ì™„ë£Œ"));
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step3_3();

// ================================================================
// ë¬¸ì œ 3-4: ê°’ ëˆ„ì  ì²´ì´ë‹
// ìš”êµ¬ì‚¬í•­:
// - Promise.resolve(10)ìœ¼ë¡œ ì‹œì‘
// - ì²« ë²ˆì§¸ then: +5
// - ë‘ ë²ˆì§¸ then: Ã—2
// - ì„¸ ë²ˆì§¸ then: -3
// - ë„¤ ë²ˆì§¸ then: ìµœì¢… ê²°ê³¼ ì¶œë ¥
// - ê° ë‹¨ê³„ë³„ë¡œ "í˜„ì¬ ê°’: X" ì¶œë ¥

function step3_4() {
  Promise.resolve(10)
    .then((result) => {
      return (result += 5);
    })
    .then((result) => {
      return (result *= 2);
    })
    .then((result) => {
      return (result -= 3);
    })
    .then((result) => {
      console.log("result : ", result);
    });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step3_4(); ìµœì¢… ê²°ê³¼: 27ì´ ë‚˜ì™€ì•¼ í•¨ (10+5=15, 15Ã—2=30, 30-3=27)

// ================================================================
// âŒ STEP 4: catchì™€ ì—ëŸ¬ ì²˜ë¦¬ (4ë¬¸ì œ)
// ================================================================

// ë¬¸ì œ 4-1: ê¸°ë³¸ catch ì‚¬ìš©ë²•
// ìš”êµ¬ì‚¬í•­:
// - Promise.reject("ë­”ê°€ ì˜ëª»ë¨")ìœ¼ë¡œ ì‹œì‘
// - catchì—ì„œ ì—ëŸ¬ë¥¼ ë°›ì•„ì„œ "ì—ëŸ¬ ì²˜ë¦¬: [ì—ëŸ¬ë©”ì‹œì§€]" í˜•íƒœë¡œ ì¶œë ¥
// - thenë„ í•¨ê»˜ ì‚¬ìš©í•´ë³´ì§€ë§Œ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸

function step4_1() {
  Promise.reject("ë­”ê°€ ì˜ëª»ë¨").catch((error) => {
    console.log("ì—ëŸ¬ ì²˜ë¦¬ : ", error);
  });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step4_1();

// ================================================================
// ë¬¸ì œ 4-2: ì²´ì´ë‹ ì¤‘ê°„ì— ì—ëŸ¬ ì²˜ë¦¬
// ìš”êµ¬ì‚¬í•­:
// - Promise.resolve(10)ìœ¼ë¡œ ì‹œì‘
// - ì²« ë²ˆì§¸ then: 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° (ì˜ë„ì ìœ¼ë¡œ ì—ëŸ¬ ë°œìƒì‹œí‚¤ê¸° - throw new Error ì‚¬ìš©)
// - ë‘ ë²ˆì§¸ then: ì‹¤í–‰ë˜ë©´ ì•ˆë¨
// - catch: ì—ëŸ¬ ì²˜ë¦¬í•˜ê³  ê¸°ë³¸ê°’ 999 ë°˜í™˜
// - ë§ˆì§€ë§‰ then: ìµœì¢… ê²°ê³¼ ì¶œë ¥

function step4_2() {
  Promise.resolve(10)
    .then((result) => {
      result /= 0;
      throw new Error("ì˜ë„ì  ì—ëŸ¬ ë°œìƒ");
    })
    .then((result) => {
      console.log(result);
    })
    .catch((error) => {
      console.log(error);
      return 999;
    })
    .then((result) => {
      console.log(result);
    });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step4_2();

// ================================================================
// ë¬¸ì œ 4-3: catch í›„ ì²´ì´ë‹ ê³„ì†
// ìš”êµ¬ì‚¬í•­:
// - Promise.reject("ì´ˆê¸° ì—ëŸ¬")ë¡œ ì‹œì‘
// - catchì—ì„œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  "ë³µêµ¬ëœ ê°’" ë°˜í™˜
// - ê·¸ ë‹¤ìŒ thenì—ì„œ "ë³µêµ¬ ì„±ê³µ: [ê°’]" ì¶œë ¥
// - catch í›„ì—ë„ ì²´ì´ë‹ì´ ê³„ì†ë  ìˆ˜ ìˆìŒì„ í™•ì¸

function step4_3() {
  Promise.reject("ì´ˆê¸° ì—ëŸ¬")
    .catch((error) => {
      console.log(error);
      return "ë³µêµ¬ëœ ê°’";
    })
    .then((result) => {
      console.log(`ë³µìˆ˜ ì„±ê³µ : ${result}`);
    });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// step4_3();

// ================================================================
// ë¬¸ì œ 4-4: ì¡°ê±´ë¶€ ì—ëŸ¬ ë°œìƒ
// ìš”êµ¬ì‚¬í•­:
// - checkNumber(num) í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”
// - ë§¤ê°œë³€ìˆ˜ê°€ 0ë³´ë‹¤ í¬ë©´ "ì–‘ìˆ˜ì…ë‹ˆë‹¤!" ë°˜í™˜
// - 0ì´ë©´ "0ì…ë‹ˆë‹¤!" ë°˜í™˜
// - ìŒìˆ˜ë©´ throw new Error("ìŒìˆ˜ëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!")
// - Promise.resolve()ë¡œ ê°ì‹¸ì„œ Promise ë°˜í™˜

function checkNumber(num) {
  return Promise.resolve(num).then((num) => {
    if (num > 0) {
      return "ì–‘ìˆ˜ì…ë‹ˆë‹¤.";
    } else if (num < 0) {
      throw new Error("ìŒìˆ˜ëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
    } else {
      return "0ì…ë‹ˆë‹¤";
    }
  });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// checkNumber(5)
//   .then(console.log)
//   .catch((err) => console.log("ì—ëŸ¬:", err.message));
// checkNumber(0)
//   .then(console.log)
//   .catch((err) => console.log("ì—ëŸ¬:", err.message));
// checkNumber(-3)
//   .then(console.log)
//   .catch((err) => console.log("ì—ëŸ¬:", err.message));

// ================================================================
// ğŸ¯ STEP 5: finallyì™€ ì™„ë£Œ ì²˜ë¦¬ (3ë¬¸ì œ)
// ================================================================

// ë¬¸ì œ 5-1: ê¸°ë³¸ finally ì‚¬ìš©ë²•
// ìš”êµ¬ì‚¬í•­:
// - successOrFail() í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”
// - 50% í™•ë¥ ë¡œ ì„±ê³µ("ì„±ê³µ!") ë˜ëŠ” ì‹¤íŒ¨(Error("ì‹¤íŒ¨!"))
// - thenì—ì„œ ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
// - catchì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
// - finallyì—ì„œ "ì‘ì—… ì™„ë£Œ" ì¶œë ¥ (ì„±ê³µ/ì‹¤íŒ¨ ê´€ê³„ì—†ì´)

function successOrFail() {
  return new Promise((resolve, reject) => {
    if (Math.random() > 0.5) {
      // 50% í™•ë¥ 
      resolve("ì„±ê³µ!");
    } else {
      reject(new Error("ì‹¤íŒ¨!"));
    }
  })
    .then((msg) => console.log(msg))
    .catch((error) => console.log("ì—ëŸ¬:", error.message))
    .finally(() => console.log("ì‘ì—… ì™„ë£Œ"));
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// successOrFail()

// ================================================================
// ë¬¸ì œ 5-2: ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì‹œë®¬ë ˆì´ì…˜
// ìš”êµ¬ì‚¬í•­:
// - processData() í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”
// - "ë°ì´í„° ì²˜ë¦¬ ì‹œì‘" ì¶œë ¥
// - 2ì´ˆ í›„ 70% í™•ë¥ ë¡œ ì„±ê³µ, 30% í™•ë¥ ë¡œ ì‹¤íŒ¨
// - ì„±ê³µì‹œ: "ë°ì´í„° ì²˜ë¦¬ ì„±ê³µ"
// - ì‹¤íŒ¨ì‹œ: "ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨" ì—ëŸ¬
// - finallyì—ì„œ "ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì™„ë£Œ" ì¶œë ¥

function processData() {
  let probabilty = Math.random();
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (probabilty > 0.3) {
        resolve("ë°ì´í„° ì²˜ë¦¬ ì„±ê³µ");
      } else {
        reject("ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨");
      }
    }, 2000);
  }).finally(() => {
    console.log("ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì™„ë£Œ");
  });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
processData()
  .then((result) => console.log(result))
  .catch((error) => console.log("ì—ëŸ¬:", error))
  .finally(() => console.log("ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ì™„ë£Œ"));

// ================================================================
// ë¬¸ì œ 5-3: finallyì˜ íŠ¹ì„± ì´í•´
// ìš”êµ¬ì‚¬í•­:
// - finallyTest() í•¨ìˆ˜ë¥¼ ë§Œë“œì„¸ìš”
// - Promise.resolve("ì›ë˜ ê°’")ìœ¼ë¡œ ì‹œì‘
// - thenì—ì„œ ê°’ì„ "ë³€ê²½ëœ ê°’"ìœ¼ë¡œ ìˆ˜ì •
// - finallyì—ì„œ "ì •ë¦¬ ì‘ì—…" ì¶œë ¥í•˜ê³  "finally ê°’" ë°˜í™˜ (í•˜ì§€ë§Œ ì´ ê°’ì€ ë¬´ì‹œë¨)
// - ë§ˆì§€ë§‰ thenì—ì„œ ìµœì¢… ê°’ ì¶œë ¥
// - finallyëŠ” ê°’ì„ ë³€ê²½í•˜ì§€ ì•ŠìŒì„ í™•ì¸

function finallyTest() {
  Promise.resolve("ì›ë˜ ê°’")
    .then((result) => {
      result = "ë³€ê²½ëœ ê°’";
      return result;
    })
    .finally(() => {
      console.log("ì •ë¦¬ ì‘ì—…");
      return "finally ê°’";
    })
    .then((finalResult) => {
      console.log(finalResult);
    });
}

// í…ŒìŠ¤íŠ¸ ì½”ë“œ
// finallyTest(); // "ë³€ê²½ëœ ê°’"ì´ ì¶œë ¥ë˜ì–´ì•¼ í•¨ (finallyì˜ ë°˜í™˜ê°’ì´ ì•„ë‹˜)
